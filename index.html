<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Language Runner</title>
  <style>
    body {
      margin: 0;
      font-family: monospace;
      background: #111;
      color: #fff;
    }
    textarea {
      width: 100%;
      height: 200px;
      background: #222;
      color: #0f0;
      border: none;
      padding: 10px;
      box-sizing: border-box;
      resize: none;
    }
    #previewCanvas {
      width: 100%;
      height: 400px;
      background: #000;
      display: block;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body onload="loadCode()">

  <textarea id="codeArea" placeholder="Enter custom language code here..."></textarea>
  <canvas id="previewCanvas" width="800" height="400"></canvas>
  <div>
    <button onclick="runCustomCode()">Run</button>
    <button onclick="previewInNewTab()">Preview in New Tab</button>
    <button onclick="exportHTML()">Export to HTML</button>
    <button onclick="exportJava()">Export to Java</button>
  </div>

  <script>
    function convertCustomToJS(code) {
      // Dummy parser for the custom language (real logic should be added here)
      let js = `
        const canvas = document.getElementById('previewCanvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(100, 100, 100, 100);
      `;
      return js;
    }

    function runCustomCode() {
      const code = document.getElementById('codeArea').value;
      const jsCode = convertCustomToJS(code);

      const canvas = document.getElementById('previewCanvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      try {
        eval(jsCode);
      } catch (e) {
        alert('Error: ' + e.message);
      }

      saveCode();
    }

    function previewInNewTab() {
      const code = document.getElementById('codeArea').value;
      const jsCode = convertCustomToJS(code);
      const win = window.open();
      win.document.write(`<!DOCTYPE html><html><body><canvas id='previewCanvas' width='800' height='400'></canvas><script>${jsCode}<\/script></body></html>`);
      win.document.close();
    }

    function exportHTML() {
      const code = document.getElementById('codeArea').value;
      const jsCode = convertCustomToJS(code);
      const htmlContent = `<!DOCTYPE html><html><body><canvas id='previewCanvas' width='800' height='400'></canvas><script>${jsCode}<\/script></body></html>`;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'exported_game.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function exportJava() {
      const javaCode = `
import javax.swing.*;
import java.awt.*;

public class GameApp {
  public static void main(String[] args) {
    JFrame frame = new JFrame("Game Preview");
    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    frame.setSize(800, 400);
    frame.setVisible(true);
    JPanel panel = new JPanel() {
      protected void paintComponent(Graphics g) {
        super.paintComponent(g);
        g.setColor(Color.WHITE);
        g.fillRect(100, 100, 100, 100);
      }
    };
    frame.add(panel);
  }
}`;
      const blob = new Blob([javaCode], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'GameApp.java';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function saveCode() {
      const code = document.getElementById('codeArea').value;
      localStorage.setItem('customLangCode', code);
    }

    function loadCode() {
      const code = localStorage.getItem('customLangCode');
      if (code) {
        document.getElementById('codeArea').value = code;
      }
    }
  </script>
</body>
</html>
